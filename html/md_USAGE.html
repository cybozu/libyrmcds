<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>libyrmcds: Usage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">libyrmcds
   </div>
   <div id="projectbrief">memcached/yrmcds client library for C</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Usage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><code>yc</code> </h2>
<p><code>yc</code> is a memcached/yrmcds client program. It provides access to all libyrmcds library functions therefore access to all server functions.</p>
<p><code>yc</code> prints out its usage when invoked without command-line arguments.</p>
<h2>Minimal example </h2>
<p>```c #include &lt;<a class="el" href="yrmcds_8h.html" title="libyrmcds public API. ">yrmcds.h</a>&gt;</p>
<p>#include &lt;errno.h&gt; #include &lt;error.h&gt; #include &lt;stdlib.h&gt; #include &lt;stdio.h&gt;</p>
<p>void check_error(yrmcds_error e) { if( e != 0 ) { if( e == YRMCDS_SYSTEM_ERROR ) { error(0, errno, "system error"); } else { fprintf(stderr, "yrmcds error: %s\n", yrmcds_strerror(e)); } exit(2); } }</p>
<p>void check_response(const yrmcds_response* r) { if( r-&gt;status != YRMCDS_STATUS_OK ) { fprintf(stderr, "Command failed: 0x%04x %.*s\n", r-&gt;status, (int)r-&gt;data_len, r-&gt;data); exit(3); } }</p>
<p>int main(int argc, char** argv) { yrmcds c; <a class="el" href="structyrmcds__response.html" title="Data structure to store a response packet. ">yrmcds_response</a> r;</p>
<p>check_error( yrmcds_connect(&amp;c, "localhost", 11211) ); check_error( yrmcds_noop(&amp;c, NULL) ); check_error( yrmcds_recv(&amp;c, &amp;r) ); check_response(&amp;r); check_error( yrmcds_close(&amp;c) );</p>
<p>return 0; } ```</p>
<h2>Compilation and linking </h2>
<p>Link with <code>-lyrmcds -lpthread</code> as follows:</p>
<p>``` gcc -g -O2 -o foo foo.c -lyrmcds -lpthread ```</p>
<h2>Request serial number </h2>
<p>All command sending functions can issue a unique serial number of the command. This can be used when you receive responses asynchronously as described in the next section.</p>
<p>```c uint32_t async_cas(yrmcds* c) { uint32_t serial; // try compare-and-swap check_error( yrmcds_set(&amp;c, "abc", 3, "12345", 5, 0, 0, 5, 0, &amp;serial) ); return serial; } ```</p>
<h2>Multi-threading </h2>
<p>All functions in libyrmcds are thread-safe as long as different <code>yrmcds</code> structs are used. Additionally, any number of threads can use command sending functions such as <code><a class="el" href="group__yrmcds__functions_ga5d73092760e559b846548fb068d3828c.html#ga5d73092760e559b846548fb068d3828c" title="Send Get/GetQ command. ">yrmcds_get()</a></code> or <code><a class="el" href="group__yrmcds__functions_ga9841be80e03c7383a5cf872cd312eeea.html#ga9841be80e03c7383a5cf872cd312eeea" title="Send Set/SetQ command. ">yrmcds_set()</a></code> even when they share the same <code>yrmcds</code> struct.</p>
<p>Further, <code><a class="el" href="group__yrmcds__functions_ga22b7188460f5b62cc0d42566cfd513ef.html#ga22b7188460f5b62cc0d42566cfd513ef" title="Receives a response packet. ">yrmcds_recv()</a></code> can be used in parallel with command sending functions. You can create a dedicated thread to receive server responses asynchronously. Use request serial numbers to identify a response's request.</p>
<p>```c void async_recv(yrmcds* c, void (<em>notify)(uint32_t, <a class="el" href="structyrmcds__response.html" title="Data structure to store a response packet. ">yrmcds_response</a></em> r)) { yrmcds_respone r; while( 1 ) { check_error( yrmcds_recv(&amp;c, &amp;r) ); (<em>notify)(r.serial, &amp;r); } } ```</em></p>
<p><em>You can use <code><a class="el" href="group__yrmcds__functions_ga07fae0924461ab86f3295ffdb0979ccf.html#ga07fae0924461ab86f3295ffdb0979ccf" title="Shutdown the receiving end of the socket. ">yrmcds_shutdown()</a></code> to interrupt the thread blocking in <code><a class="el" href="group__yrmcds__functions_ga22b7188460f5b62cc0d42566cfd513ef.html#ga22b7188460f5b62cc0d42566cfd513ef" title="Receives a response packet. ">yrmcds_recv()</a></code> for graceful exit.</em></p>
<p><em></p>
<h2>Transparent compression </h2>
<p></em></p>
<p><em></em></p>
<p><em>libyrmcds provides optional transparent data compression by <a href="https://code.google.com/p/lz4/">LZ4</a>.</em></p>
<p><em>To use this feature, the library must be built with LZ4 as follows:</em></p>
<p><em>``` $ make lz4 $ make ```</em></p>
<p><em>If the library supports LZ4 compression, you can enable transparent LZ4 (de)compression for large objects. The threshold for compression can be set by <code><a class="el" href="group__yrmcds__functions_ga0031a01d5b2d00b22b29f721f0774175.html#ga0031a01d5b2d00b22b29f721f0774175" title="Enable/disable (de)compression for large objects. ">yrmcds_set_compression()</a></code>. The compression is disabled by default.</em></p>
<p><em>Note that all clients must support and enable the compression to properly handle compressed data.</em></p>
<p><em></p>
<h2>Counter extension </h2>
<p></em></p>
<p><em></em></p>
<p><em>yrmcds has a distributed counter extension for resource management. If the extension is enabled in server, you can access counters by `yrmcds_cnt_</em><code>functions. The usage of each function is very similar to the corresponding</code>yrmcds_` function.</p>
<p>The minimum example is:</p>
<p>```c #include &lt;<a class="el" href="yrmcds_8h.html" title="libyrmcds public API. ">yrmcds.h</a>&gt;</p>
<p>#include &lt;errno.h&gt; #include &lt;error.h&gt; #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt;</p>
<p>void check_error(yrmcds_error e) { if( e != YRMCDS_OK ) { if( e == YRMCDS_SYSTEM_ERROR ) { error(0, errno, "system error"); } else { fprintf(stderr, "yrmcds error: %s\n", yrmcds_strerror(e)); } exit(2); } }</p>
<p>void check_response(const yrmcds_cnt_response* r) { if( r-&gt;status != YRMCDS_STATUS_OK ) { fprintf(stderr, "Command failed: 0x%02x %.*s\n", r-&gt;status, (int)r-&gt;body_length, r-&gt;body); exit(3); } }</p>
<p>int main(void) { <a class="el" href="structyrmcds__cnt.html" title="Data structure of a connection to yrmcds counter server. ">yrmcds_cnt</a> c; <a class="el" href="structyrmcds__cnt__response.html" title="Data structure to store a response packet for the counter extension. ">yrmcds_cnt_response</a> r;</p>
<p>check_error( yrmcds_cnt_connect(&amp;c, "localhost", 11215) ); check_error( yrmcds_cnt_noop(&amp;c, NULL) ); check_error( yrmcds_cnt_recv(&amp;c, &amp;r) ); check_response(&amp;r); check_error( yrmcds_cnt_close(&amp;c) );</p>
<p>return 0; } ```</p>
<h2>API documents </h2>
<p>HTML documents generated with Doxygen is available <a href="http://cybozu.github.io/libyrmcds/html/">here</a>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jan 17 2016 19:30:37 for libyrmcds by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
